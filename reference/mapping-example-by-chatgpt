
let $sfid_partner_id := generateUUID()
let $oftp_partner_id := generateUUID()
let $partner_auth_cert_id := generateUUID()
let $partner_eerp_cert_id := generateUUID()
let $partner_encrypt_cert_id := generateUUID()
let $partner_auth_cert_alias := concat (getInputParameter("participantid"), "-partnerauth")
let $partner_eerp_cert_alias := concat (getInputParameter("participantid"), "-partnereerp")
let $partner_encrypt_cert_alias := concat (getInputParameter("participantid"), "-partnerencrypt")


transport <- /root
{
  @id := getInputParameter("participantid")
  @valid := true()
  @format := "xml"
  @security-level := "plain"

  processing := "auto-apply"

  records
  {
    record
    {
      @name := getInputParameter("participantid")
      @type := "oftp.sfid-partner"
      @rest-identifier := $sfid_partner_id 
	  
      sfid-partner
      {
        @identifier := $sfid_partner_id 
        name := getInputParameter("participantid")

        odette-code := /root/sfid_partner
        sfid-user-field := ""
        clearing-center := false()

        authentication-certificates
        {
          authentication-certificate
          {
            certificate-ref { @href := concat ("https://dedcdbdmgr01:14000/api/ksm/TRUSTED/TRUSTED_INSTANCES/", $partner_auth_cert_alias) }
          }
        }

        encryption-certificates
        {
          encryption-certificate
          {
            certificate-ref { @href := concat ("https://dedcdbdmgr01:14000/api/ksm/TRUSTED/TRUSTED_INSTANCES/", $partner_encrypt_cert_alias ) }
          }
        }

        eerp-authentication-certificates
        {
          eerp-authentication-certificate
          {
            certificate-ref { @href := concat ("https://dedcdbdmgr01:14000/api/ksm/TRUSTED/TRUSTED_INSTANCES/", $partner_eerp_cert_alias) }
          }
        }

        send
        {
		  sign := if (signature_type = "NONE") then false() else true()
          signature-algorithm := if (signature_type != "NONE") then signature_type else "NONE"
          encrypt := if (encryption_type = "NONE") then false() else true()
          encryption-algorithm := if (encryption_type != "NONE") then encryption_type else ""
          compress := false()
          send-eerp-immediately := eerp_handling/send_eerp_immediately
          request-signed-eerp := false()
          disable-eerp-sending := false()
          disable-eerp-sending-in-receiver-only-mode := false()
          eerp-user-field := ""
          report-queue := "OFTP-TCP Client/Controller-ReportQueue"
          cipher-suite := "00 NONE"
        }

        receive
        {
          disable-check-for-incoming-transfer-duplicates := false()
          format-received-fix-files := false()
          accept-only-signed-files := false()
          accept-only-encrypted-files := false()
          partner-sends-eerp := eerp_handling/wait_for_partner_eerp
          eerp-timeout := eerp_handling/eerp_reception_timeout
          eerp-timeout-unit := "H"
          correlate-eerps-in-process-engine := true()
          accept-unsigned-eerp := false()
        }
      }
    } 

    record
    {
      @name := getInputParameter("participantid")
      @type := "oftp.oftp-partner"
      @rest-identifier := $oftp_partner_id
		
      oftp-v2-partner
      {
		@identifier := $oftp_partner_id
        name := getInputParameter("participantid")

        active := true()

        ssid
        {
          ssid-personality
          {
            name := "O0013000031SEE30532CL03"
            odette-code := "O0013000031SEE30532CL03"
            password := "SEEBUR"
            session-authentication-certificates { }
          }
          ssid-partner
          {
            name := getInputParameter("participantid")
            odette-code := ssid_partner/odette_code
            password := ssid_partner/password
            session-authentication-certificates { }
          }

          session-configuration
          {
            protocol-version := "1.4"
            transfer-direction := "both"
            enable-multiple-sessions := true()
            session-timeout := "300"
            call-timeout := "60"
            buffer-size := "32765"
            acknowledgement-interval := "50"
            enable-compression := false()
            enable-restart := true()
            character-encoding := "UTF-8"
            request-secure-authentication := false()

            sequence-processing
            {
              use-sequence := false()
            }

            asynchronous-incoming-files-processing
            {
              enable-asynchronous-processing := false()
              minimum-file-size := 128
            }
          }
        }

        sfid
        {
          sfid-partners
          {
            sfid-partner
            {
              sfid-partner-ref { @href := concat ("https://dedcdbdmgr01:14000/api/oftp/v2/sfid-partners/", $sfid_partner_id)}
              name := "O0013000031SEE30532CL05"
              odette-code := "O0013000031SEE30532CL05"
            }
          } 

          sfid-personalities
          {
            sfid-personality
            {
              sfid-personality-ref { @href := "https://dedcdbdmgr01:14000/api/oftp/v2/sfid-personalities/273f6310-37b1-11f0-8e28-c61e7f000101" }
              name := "sfidPersonalityProcessCreated"
              odette-code := "O0013000031SEE30532CL03"
            }
          }
        }
		

        partner-tcp-configuration
        {
          hostname := /root/system_partner/host
          port := /root/system_partner/port
          use-tls := false()

          tls
          {
            trust-model := "CA"
            use-system-truststore := true()
            disable-hostname-check := false()
            server-certificates { }
            security-profile { @href := "https://dedcdbdmgr01:14000/api/security-profile/profiles/DEFAULT" }
            use-client-authentication := false()
          }

          check-tls := false()
        }

        listeners
        {
          listener { @href := "https://dedcdbdmgr01:14000/api/oftp/listeners/26fcb4c0-37b1-11f0-8e28-c61e7f000101" }
        }
      }
    } 

    record
    {
      @name := $partner_auth_cert_alias
      @type := "ksm-entry"
      @rest-identifier := $partner_auth_cert_id
      
	  keystore-entry
      {  
		@identifier := $partner_auth_cert_id
       
        type := "CERTIFICATE"
        alias := $partner_auth_cert_alias
        path := "TRUSTED\\TRUSTED_INSTANCES"

        subject-details
        {
          common-name := "oftp2test"
        }

        key-settings
        {
          sign-algorithm := "SHA512WithRSA"
          public-key-size := 2048
          private-key-algorithm := "RSA"
        }

        extensions
        {
          key-usage
          {
            digital-signature := true()
            data-encipherment := true()
            non-repudation := false()
            verify-certificate-signatures := false()
            key-encipherment := true()
            server-authentication := false()
            client-authentication := false()
            email-protection := false()
            key-agreement := false()
            encipher-only := false()
            decipher-only := false()
            verify-crl-signatures := false()
          }
          basic-constraint := "END"
          ca-path-length-constraint := "-1"
          alternative-subject-names := ""
        }

        raw-content
        {
          payload := /root/certificate_partner/file_signature/file_signature_certificate/certificate
        }

        validation
        {
          validation-settings
          {
            period := "yes"
            chain := "yes"
            ocsp := "no"
            ocsp-online := "no"
            crl := "no"
            force-valid := "no"
          }
          validity-status := "valid"
          validation-time := "2025-09-12T08:37:26Z"
        }

        validation-state := "enabled"
        provided-password := "seeburger"
      }
    }

    record
    {
      @name := $partner_eerp_cert_alias
      @type := "ksm-entry"
      @rest-identifier := $partner_eerp_cert_id
	  
      keystore-entry
      {
		@identifier := $partner_eerp_cert_id


        type := "CERTIFICATE"
        alias := $partner_eerp_cert_alias
        path := "TRUSTED\\TRUSTED_INSTANCES"
 
        subject-details
        {
          common-name := "oftp2test"
        }

        key-settings
        {
          sign-algorithm := "SHA512WithRSA"
          public-key-size := 2048
          private-key-algorithm := "RSA"
        }

        extensions
        {
          key-usage
          {
            digital-signature := true()
            data-encipherment := true()
            non-repudation := false()
            verify-certificate-signatures := false()
            key-encipherment := true()
            server-authentication := false()
            client-authentication := false()
            email-protection := false()
            key-agreement := false()
            encipher-only := false()
            decipher-only := false()
            verify-crl-signatures := false()
          }
          basic-constraint := "END"
          ca-path-length-constraint := "-1"
          alternative-subject-names := ""
        }

        raw-content
        {
          payload := /root/certificate_partner/eerp_signature/eerp_signature_certificate/certificate
		}

        validation
        {
          validation-settings
          {
            period := "yes"
            chain := "yes"
            ocsp := "no"
            ocsp-online := "no"
            crl := "no"
            force-valid := "no"
          }
          validity-status := "valid"
          validation-time := "2025-09-12T08:37:58Z"
        }

        validation-state := "enabled"
        provided-password := "seeburger"
      }
    }

    record
    {
      @name := $partner_encrypt_cert_alias
      @type := "ksm-entry"
      @rest-identifier := $partner_encrypt_cert_id 

      keystore-entry
      {
        @identifier := $partner_encrypt_cert_id

        type := "CERTIFICATE"
        alias := $partner_encrypt_cert_alias
        path := "TRUSTED\\TRUSTED_INSTANCES"
        version := "3"

        subject-details
        {
          common-name := "oftp2test"
        }

        key-settings
        {
          sign-algorithm := "SHA512WithRSA"
          public-key-size := 2048
          private-key-algorithm := "RSA"
        }

        extensions
        {
          key-usage
          {
            digital-signature := true()
            data-encipherment := true()
            non-repudation := false()
            verify-certificate-signatures := false()
            key-encipherment := true()
            server-authentication := false()
            client-authentication := false()
            email-protection := false()
            key-agreement := false()
            encipher-only := false()
            decipher-only := false()
            verify-crl-signatures := false()
          }
          basic-constraint := "END"
          ca-path-length-constraint := "-1"
          alternative-subject-names := ""
        }

        raw-content
        {
          payload := /root/certificate_partner/file_encryption/file_encryption_certificate/certificate
		}

        validation
        {
          validation-settings
          {
            period := "yes"
            chain := "yes"
            ocsp := "no"
            ocsp-online := "no"
            crl := "no"
            force-valid := "no"
          }
          validity-status := "valid"
          validation-time := "2025-09-12T08:42:27Z"
        }

        validation-state := "enabled"
        provided-password := "seeburger"
      }
    }
	

    record
    {
      @name := "REST Created Listener"
      @type := "oftp.oftp-listener"
      @rest-identifier := "26fcb4c0-37b1-11f0-8e28-c61e7f000101"
      @action := "update"
      @created-at := "2025-09-12T08:46:25Z"
      @created-by := "seeadmin"
      @last-modified-by := "seeadmin"
      @last-modified-at := "2025-09-12T08:46:25Z"

      oftp-listener
      {
        @identifier := "26fcb4c0-37b1-11f0-8e28-c61e7f000101"
        name := "REST Created Listener"

        listener-group := "Role:AdapterEngine"
        active := true()

        listener-tcp-configuration
        {
          network-interface := "oftp2.seeburger.cloud"
          port := "6619"
          use-tls := false()

          listener-tls
          {
            ssl-server-certificates { }
            security-profile { @href := "https://dedcdbdmgr01:14000/api/security-profile/profiles/DEFAULT" }
          }

          check-tls := false()
        }
      }
    }

   record
    {
      @name := "sfidPersonalityProcessCreated"
      @type := "oftp.sfid-personality"
	  @rest-identifier := "273f6310-37b1-11f0-8e28-c61e7f000101"

      sfid-personality
      {
        @identifier := "273f6310-37b1-11f0-8e28-c61e7f000101"
		name := "sfidPersonalityProcessCreated"
        odette-code := "O0013000031SEE30532CL03"

        signature-certificates
        {
          signature-certificate
          {
            @effective-from-date-time := "2025-09-08T08:06:22Z"
            certificate-ref { @href := "https://dedcdbdmgr01:14000/api/ksm/USERS/INSTANCES/demoim" }
          }
        }

        decryption-certificates
        {
          decryption-certificate
          {
            certificate-ref { @href := "https://dedcdbdmgr01:14000/api/ksm/USERS/INSTANCES/demoim" }
          }
        }

        eerp-signature-certificates
        {
          eerp-signature-certificate
          {
            @effective-from-date-time := "2025-09-08T08:06:41Z"
            certificate-ref { @href := "https://dedcdbdmgr01:14000/api/ksm/USERS/INSTANCES/demoim" }
          }
        }
      } 
    }  
  }
}